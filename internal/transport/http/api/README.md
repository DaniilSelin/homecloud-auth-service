# Система Аутентификации

Этот документ описывает систему аутентификации, реализованную в приложении VotingSystem.

## Поток Аутентификации

1. **Регистрация**: Пользователи регистрируются, указывая email, пароль и другую необходимую информацию.
2. **Вход**: Пользователи входят в систему, используя email и пароль, чтобы получить JWT токен.
3. **Аутентификация**: Каждый защищённый запрос требует действительного JWT токена.
4. **Обновление Токена**: Токены могут быть обновлены для продления сессии.

## Эндпоинты

### Публичные Эндпоинты

- `POST /users` - Регистрация нового пользователя через стандартный API
- `POST /user/registry` - Регистрация нового пользователя (с возвратом токена)
- `POST /user/login` - Вход в систему и получение JWT токена
- `POST /user/refresh` - Обновление JWT токена
- `GET /user/auth` - Проверка действительности JWT токена

### Защищённые Эндпоинты

Эти эндпоинты требуют действительного JWT токена в заголовке Authorization:

- `GET /users/{id}` - Получение информации о пользователе
- `PUT /users/{id}` - Обновление информации о пользователе
- `DELETE /users/{id}` - Удаление пользователя

## Регистрация Пользователя

Эндпоинт регистрации принимает следующие параметры:

```json
{
  "name": "Имя пользователя",
  "email": "user@example.com",
  "password": "пароль",
  "role": "user" // опционально, по умолчанию "user"
}
```

И возвращает:

```json
{
  "user_id": 123,
  "token": "jwt_token_для_аутентификации"
}
```

При регистрации выполняются следующие проверки:
- Наличие обязательных полей (имя, email, пароль)
- Валидность формата email
- Минимальная длина пароля (6 символов)
- Уникальность email (один email - один пользователь)

## Заголовки Аутентификации

Для защищённых эндпоинтов необходимо включить JWT токен в заголовок Authorization:

```
Authorization: Bearer <token>
```

## Обработка Ошибок

Все ошибки аутентификации в настоящее время возвращают статус 500 с сообщением об ошибке.

## Детали Реализации

Система аутентификации реализована с использованием следующих компонентов:

1. **Security Package**: Обрабатывает хеширование паролей и операции с JWT.
2. **User Service**: Содержит бизнес-логику для аутентификации и регистрации.
3. **API Handlers**: HTTP эндпоинты для операций аутентификации.
4. **Middleware**: Защищает маршруты от несанкционированного доступа.

## Жизненный Цикл Токена

1. **Создание**: Токены создаются во время входа или регистрации.
2. **Проверка**: Токены проверяются для каждого защищённого запроса.
3. **Обновление**: Токены могут быть обновлены для продления срока действия.
4. **Истечение Срока**: Токены истекают по прошествии настраиваемого периода времени.

## Будущие Улучшения

- Добавить авторизацию на основе ролей для более детального контроля доступа
- Реализовать отзыв токенов для функциональности выхода
- Добавить ограничение частоты запросов к эндпоинтам аутентификации для предотвращения атак перебора

